<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9" />
    <link rel="stylesheet" type="text/css" href="../../../css/styles.css" />
    <link rel="stylesheet" type="text/css" href="../../../css/snippet.css" />
    <script type="text/javascript" src="../../../scripts/snippet.js"></script>
    <script type="text/javascript" src="../../../scripts/jquery.util.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../../scripts/common.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../../scripts/core.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../../scripts/search.js" charset="utf-8"></script>
  <title>HTML5 Web Messaging</title>
 </head>
 <body onload="prettyPrint()" style="overflow: auto;">

 <div id="toc-navigation">
    <div id="profile">
        <p><img alt="Mobile Web" src="../../../images/mobile_s_w.png"/> <img alt="Wearable Web" src="../../../images/wearable_s_w.png"/></p>
    </div>

    <div id="toc_border"><div id="toc">
		<p class="toc-title">Dependencies</p>
		<ul class="toc">
			<li>Tizen Platform 2.4 and Higher for Mobile</li>
			<li>Tizen Platform 2.3.1 and Higher for Wearable</li>
		</ul>
        <p class="toc-title">Content</p>
        <ul class="toc">
            <li><a href="#cross">Cross-document Messaging</a></li>
			<li><a href="#channel">Channel Messaging</a></li>
			<li><a href="#Cross-document_Messaging">Using Cross-document Messaging</a></li>
			<li><a href="#Channel_Messaging">Using Channel Messaging</a></li>
		</ul>
		<p class="toc-title">Related Info</p>
        <ul class="toc">
			<li><a href="../../../../../org.tizen.web.apireference/html/w3c_api/w3c_api_m.html#messaging">HTML5 Web Messaging API for Mobile Web</a></li>
			<li><a href="../../../../../org.tizen.web.apireference/html/w3c_api/w3c_api_w.html#messaging">HTML5 Web Messaging API for Wearable Web</a></li>
            </ul>
    </div></div>
</div>

<div id="container"><div id="contents"><div class="content">
<h1>HTML5 Web Messaging</h1>

<p>Web messaging is used to deliver messages between documents. Web messaging allows <a href="../security/cors_w.htm">cross-origin resource sharing (CORS)</a>.</p>

<p>With the Web Messaging API, messages are sent and received:</p>

<ul>
<li>Using the <a href="http://www.w3.org/TR/2012/CR-webmessaging-20120501/#event-definitions" target="_blank">MessageEvent</a> object</li>
<li>Asynchronously</li>
<li>Within 1 domain or between different domains</li>
</ul>

<h2 name="cross" id="cross">Cross-document Messaging</h2>
<p>You can <a href="#Cross-document_Messaging">send and receive data between more than 2 Web pages</a>. Because the <a href="http://www.w3.org/2001/tag/dj9/scriptorigin.html" target="_blank">Same Origin Policy</a> is not applied for cross-document messaging, communication between other domains is also possible.</p>
<p>Send the message from the sending page using the <span style="font-family: Courier New,Courier,monospace">postMessage()</span> method of the <a href="http://www.w3.org/TR/2012/CR-webmessaging-20120501/#posting-messages" target="_blank">receiving page window object</a>. To receive the page, the receiving page window object must be registered to receive messages.</p>
<p>The <span style="font-family: Courier New,Courier,monospace">postMessage()</span> method supports the following parameters:</p>
<ul>
<li><span style="font-family: Courier New,Courier,monospace">message</span>: Message to be sent.</li>
<li><span style="font-family: Courier New,Courier,monospace">targetOrigin</span>: Domain receiving the message. If a certain domain cannot be defined, use the wildcard (&#39;*&#39;).</li>
<li><span style="font-family: Courier New,Courier,monospace">transfer</span> (optional): List of transferable objects.</li>
</ul>

<h2 name="channel" id="channel">Channel Messaging</h2>
<p>With channel messaging, you can <a href="#Channel_Messaging">send and receive messages through the port</a> of the <a href="http://www.w3.org/TR/2012/CR-webmessaging-20120501/#message-channels" target="_blank">MessageChannel</a> interface.</p>
<p>The <span style="font-family: Courier New,Courier,monospace">MessageChannel</span> instance broadcasts message sending and receiving, and has 2 properties: <span style="font-family: Courier New,Courier,monospace">port1</span> and <span style="font-family: Courier New,Courier,monospace">port2</span>. Each port is used to send and receive messages, and a message that is sent from one port with the <span style="font-family: Courier New,Courier,monospace">postMessage()</span> method is received by the other through the <span style="font-family: Courier New,Courier,monospace">message</span> event.</p>

<h2>Warm-up</h2>
        <p>Become familiar with the HTML5 Web Messaging API basics by learning about:</p>
        <ul>
            <li><a href="#Cross-document_Messaging">Using Cross-document Messaging</a><p>Send a message from document A to document B using the <span style="font-family: Courier New,Courier,monospace">postMessage()</span> method.</p></li>
            <li><a href="#Channel_Messaging">Using Channel Messaging</a><p>Send a message from document A to document B using the message channel ports.</p></li>
        </ul>

  <h2 id="Cross-document_Messaging" name="Cross-document_Messaging">Using Cross-document Messaging</h2>
  
<p>Learning how to use cross-document messaging enhances the communication capabilities of your application:</p>  
<ol>
<li>Create document A and B.</li>
<li>Insert document B as <span style="font-family: Courier New,Courier,monospace">iframe</span> into document A:
<pre class="prettyprint">
&lt;iframe id=&quot;frame1&quot; src=&quot;./web_messaging_cross_document_messaging_iframe.htm&quot;&gt;&lt;/iframe&gt;
</pre>
</li>
<li>In document A, use the <span style="font-family: Courier New,Courier,monospace">sendMessage()</span> method to send a message to document B.
<p>Use the <span style="font-family: Courier New,Courier,monospace">postMessage()</span> method of the <span style="font-family: Courier New,Courier,monospace">iframe</span> window, which sends the message from the method content, to deliver the message to the <span style="font-family: Courier New,Courier,monospace">iframe</span>.</p>
<pre class="prettyprint">
&lt;script&gt;
&nbsp;&nbsp;&nbsp;function sendMessage(message) 
&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var frame1 = document.getElementById(&#39;frame1&#39;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frame1.contentWindow.postMessage(message, &#39;*&#39;);
&nbsp;&nbsp;&nbsp;}
&lt;/script&gt;
</pre>
</li>
<li>Register the <span style="font-family: Courier New,Courier,monospace">message</span> event handler in document B to receive the sent message:
<pre class="prettyprint">
&lt;script&gt;
&nbsp;&nbsp;&nbsp;btnSendMessageHandler  = function(e) 
&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var messageEle = document.getElementById(&#39;message&#39;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sendMessage(messageEle.value);
&nbsp;&nbsp;&nbsp;};
&nbsp;&nbsp;&nbsp;/* Register event handler */
&nbsp;&nbsp;&nbsp;btnSendMessage.onclick = btnSendMessageHandler;
&lt;/script&gt;
</pre>
</li>
</ol>
<h3>Source Code</h3>
 <p>For the complete source code related to this use case, see the following file:</p>
 <ul>
	<li><a href="http://download.tizen.org/misc/examples/w3c_html5/communication/html5_web_messaging" target="_blank">web_messaging_cross_document_messaging.htm</a></li>
 </ul>
  
  <h2 id="Channel_Messaging" name="Channel_Messaging">Using Channel Messaging</h2>
  
<p>Learning how to use channel messaging enhances the communication capabilities of your application:</p>  
<ol>
<li>To send a message from document A to document B, create in document A a <a href="http://www.w3.org/TR/2012/CR-webmessaging-20120501/#message-channels" target="_blank">MessageChannel</a> interface instance, which has 2 <a href="http://www.w3.org/TR/2012/CR-webmessaging-20120501/#message-ports" target="_blank">message port</a> attributes: <span style="font-family: Courier New,Courier,monospace">port1</span> and <span style="font-family: Courier New,Courier,monospace">port2</span>. 
<p>The <span style="font-family: Courier New,Courier,monospace">port2</span> attribute of the <span style="font-family: Courier New,Courier,monospace">MessageChannel</span> instance is delivered to document B through the <span style="font-family: Courier New,Courier,monospace">postMessage()</span> method of the document B window object:</p>
<pre class="prettyprint">
&lt;script&gt;
&nbsp;&nbsp;&nbsp;var messageChannel = new MessageChannel();
    
&nbsp;&nbsp;&nbsp;function setMessagePort() 
&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* iframe element ID of the port to be delivered */
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var frame1 = document.getElementById(&#39;iframe1&#39;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frame1.contentWindow.postMessage(&#39;&#39;, [messageChannel.port2], &#39;*&#39;);
&nbsp;&nbsp;&nbsp;};
    
&nbsp;&nbsp;&nbsp;window.onload = function() 
&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setMessagePort();
&nbsp;&nbsp;&nbsp;};
    
&nbsp;&nbsp;&nbsp;/* Message is sent to port2 through port1 */
&nbsp;&nbsp;&nbsp;function sendMessage(message) 
&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;messageChannel.port1.postMessage(message);
&nbsp;&nbsp;&nbsp;};
&lt;/script&gt;
</pre>
<table class="note"> 
     <tbody> 
      <tr> 
       <th class="note">Note</th> 
      </tr> 
      <tr> 
       <td class="note"><p>The <span style="font-family: Courier New,Courier,monospace">postMessage()</span> method can have 3 parameters: <span style="font-family: Courier New,Courier,monospace">message</span>, <a href="http://www.w3.org/TR/2012/CR-webmessaging-20120501/#security-postmsg" target="_blank">origin</a>, and <span style="font-family: Courier New,Courier,monospace">ports</span>.</p>
		<p>According to the W3C specifications, the arguments are ordered as <span style="font-family: Courier New,Courier,monospace">message</span>, <span style="font-family: Courier New,Courier,monospace">origin</span>, and <span style="font-family: Courier New,Courier,monospace">ports</span>. However, in Tizen, the order used is actually <span style="font-family: Courier New,Courier,monospace">message</span>, <span style="font-family: Courier New,Courier,monospace">ports</span>, and <span style="font-family: Courier New,Courier,monospace">origin</span>. This approach is used in all browsers that currently support the <span style="font-family: Courier New,Courier,monospace">MessageChannel</span> interface.</p></td> 
      </tr> 
     </tbody> 
    </table>
</li>
<li>Define a <span style="font-family: Courier New,Courier,monospace">message</span> event in the <span style="font-family: Courier New,Courier,monospace">window</span> object of document B, and register the event handler in the <span style="font-family: Courier New,Courier,monospace">port</span> sent from document A.
<pre class="prettyprint">
&lt;script&gt;
&nbsp;&nbsp;&nbsp;var port = null;
    
&nbsp;&nbsp;&nbsp;messageHandler = function(e) 
&nbsp;&nbsp;&nbsp;{      
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;port = e.ports[0];
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;port.onmessage = function(e) 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var messageEle = document.getElementById(&#39;message&#39;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;messageEle.innerHTML = e.data;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};
&nbsp;&nbsp;&nbsp;};

&nbsp;&nbsp;&nbsp;window.onmessage = messageHandler;
&lt;/script&gt;
</pre><p>A message sent through the <span style="font-family: Courier New,Courier,monospace">postMessage()</span> method of <span style="font-family: Courier New,Courier,monospace">port1</span> from document A is received through the <span style="font-family: Courier New,Courier,monospace">message</span> event of <span style="font-family: Courier New,Courier,monospace">port2</span> in document B, and the message sent through the <span style="font-family: Courier New,Courier,monospace">postMessage()</span> method of <span style="font-family: Courier New,Courier,monospace">port2</span> from document B is received through the <span style="font-family: Courier New,Courier,monospace">message</span> event of <span style="font-family: Courier New,Courier,monospace">port1</span> in document A.</p>
</li>
</ol>
<h3>Source Code</h3>
 <p>For the complete source code related to this use case, see the following files:</p>
 <ul>
	<li><a href="http://download.tizen.org/misc/examples/w3c_html5/communication/html5_web_messaging" target="_blank">web_messaging_channel_messaging.htm</a></li>
	<li><a href="http://download.tizen.org/misc/examples/w3c_html5/communication/html5_web_messaging" target="_blank">web_messaging_channel_messaging_iframe.htm</a></li>
 </ul>

<script type="text/javascript" src="../../../scripts/jquery.zclip.min.js"></script>
<script type="text/javascript" src="../../../scripts/showhide.js"></script>
</div></div></div>

<a class="top sms" href="#"><img src="../../../images/btn_top.gif" alt="Go to top" /></a>

<div id="footer">
<p class="footer">Except as noted, this content - excluding the Code Examples - is licensed under <a href="http://creativecommons.org/licenses/by/3.0/legalcode" target="_blank">Creative Commons Attribution 3.0</a> and all of the Code Examples contained herein are licensed under <a href="https://www.tizen.org/bsd-3-clause-license" target="_blank">BSD-3-Clause</a>.<br/>For details, see the <a href="https://www.tizen.org/content-license" target="_blank">Content License</a>.</p>
</div>

<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-25976949-1']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>

</body>
</html>