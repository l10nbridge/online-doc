<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=9" />
	<link rel="stylesheet" type="text/css" href="../css/styles.css" />
	<link rel="stylesheet" type="text/css" href="../css/snippet.css" />
	<script type="text/javascript" src="../scripts/snippet.js"></script>	
	<script type="text/javascript" src="../scripts/jquery.util.js" charset="utf-8"></script>
	<script type="text/javascript" src="../scripts/common.js" charset="utf-8"></script>
	<script type="text/javascript" src="../scripts/core.js" charset="utf-8"></script>
	<script type="text/javascript" src="../scripts/search.js" charset="utf-8"></script>

	<title>Compass Overview</title>  
</head>

<body onload="prettyPrint()" style="overflow: auto;">

<div id="toc-navigation">
	<div id="profile">
		<p><img alt="Mobile Web" src="../images/mobile_s_w.png"/></p>
	</div>
	
	<div id="toc_border"><div id="toc">
		<p class="toc-title">Related Info</p>
		<ul class="toc">
			<li><a href="../../../org.tizen.guides/html/web/w3c/device/device_orientation_w.htm">DeviceOrientation Event Specification Guide</a></li> 
			<li><a href="../../../org.tizen.tutorials/html/web/w3c/device/device_orientation_tutorial_w.htm">DeviceOrientation Event Specification Tutorial</a></li> 
			<li><a href="../../../org.tizen.web.apireference/html/w3c_api/w3c_api_m.html#orientation">DeviceOrientation Event Specification API</a></li>
			<li><a href="../../../org.tizen.web.apireference/html/device_api/mobile/tizen/application.html">Application API</a></li> 
		</ul>
	</div></div>
</div>	

<div id="container"><div id="contents"><div class="content">
  <h1>Compass Overview</h1> 
  <p>The Compass sample application demonstrates how you can use the W3C DeviceOrientation Event in your application to monitor the device orientation. </p> 
  <p>For information on creating the sample application project in the IDE, see <a href="../cover_page.htm#create">Creating Sample Applications</a>, and on the coding of the sample application, see <a href="../../../org.tizen.tutorials/html/web/w3c/device/task_compass_w.htm">Compass task</a>.</p>
  <p>The following figure illustrates the main screen of the Compass.</p> 
  <p class="figure">Figure: Compass screen</p> 
  <p align="center"><img alt="Compass screen" src="../images/compass.png" /> </p> 
  <p>The application opens with the main screen that shows the current device orientation.</p> 

  <h2>Source Files</h2> 
  <p>You can create and view the sample application project including the source files in the IDE.</p> 
  <table border="1"> 
   <tbody> 
    <tr> 
     <th>File name</th> 
     <th>Description</th> 
    </tr> 
    <tr> 
     <td><span style="font-family: Courier New,Courier,monospace">config.xml</span></td> 
     <td>This file contains the application information for the platform to install and launch the application, including the view mode and the icon to be used in the device menu.</td> 
    </tr> 
    <tr> 
     <td><span style="font-family: Courier New,Courier,monospace">index.html</span></td> 
     <td>This is a starting file from which the application starts loading. It contains the layout of the application screens.</td> 
    </tr> 
    <tr> 
     <td><span style="font-family: Courier New,Courier,monospace">js/main.js</span></td> 
     <td>This file contains the code for handling the device orientation functionality of the application.</td> 
    </tr> 
   </tbody> 
  </table> 
 
<h2>Implementation</h2>

<p>The <span style="font-family: Courier New,Courier,monospace">init()</span> method, which is called when the whole DOM content is loaded, initializes the application. It defines three references to the UI elements and calls the <span style="font-family: Courier New,Courier,monospace">bindEvents()</span> methods.</p>
<pre class="prettyprint">
/* main.js */
var directionEl = null,
&nbsp;&nbsp;&nbsp;&nbsp;angleEl = null,
&nbsp;&nbsp;&nbsp;&nbsp;rotationEl = null;

function init() 
{
&nbsp;&nbsp;&nbsp;directionEl = document.getElementById(&#39;direction&#39;);
&nbsp;&nbsp;&nbsp;angleEl = document.getElementById(&#39;angle&#39;);
&nbsp;&nbsp;&nbsp;rotationEl = document.getElementById(&#39;rotation&#39;);
&nbsp;&nbsp;&nbsp;bindEvents();
}

window.addEventListener(&#39;DOMContentLoaded&#39;, init);
</pre>
<p>The <span style="font-family: Courier New,Courier,monospace">bindEvents()</span> method defines handler methods for <span style="font-family: Courier New,Courier,monospace">tizenhwkey</span> and <span style="font-family: Courier New,Courier,monospace">deviceorientation</span> events. The first one uses the <span style="font-family: Courier New,Courier,monospace">exit()</span> method and allows user to close application using device hardware back button. The other one defines the <span style="font-family: Courier New,Courier,monospace">onDeviceOrientation()</span> method as a callback.</p>
<pre class="prettyprint">
/* main.js */
function bindEvents() 
{
&nbsp;&nbsp;&nbsp;window.addEventListener(&#39;tizenhwkey&#39;, function onTizenHWKey(e) 
&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (e.keyName === &#39;back&#39;) 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;});
&nbsp;&nbsp;&nbsp;window.addEventListener(&#39;deviceorientation&#39;, onDeviceOrientation, false);
}
</pre>

<p>The <span style="font-family: Courier New,Courier,monospace">onDeviceOrientation()</span> method is responsible for updating the application UI (displayed degree and direction values and compass rotation animation) according to the information obtained from the W3C DeviceOrientation event. It takes an event object describing the physical orientation of the device. To get the compass heading data, the application uses the alpha parameter of this object. The alpha parameter provides a value expressed in degrees (ranged from 0 to 360) and allows easily calculating and displaying the correct direction.</p>
<p>Another task of the <span style="font-family: Courier New,Courier,monospace">onDeviceOrientation()</span> method is to calculate the rotation of the compass. The application uses the <span style="font-family: Courier New,Courier,monospace">lastAngle</span> variable to store previously measured alpha angle in order to calculate the value of <span style="font-family: Courier New,Courier,monospace">deltaAngle</span> variable which represents the value change. Depending on the <span style="font-family: Courier New,Courier,monospace">deltaAngle</span> value, the application calculates the value of the rotation variable to provide the shortest path for the compass UI animation. The compass UI is animated using the <span style="font-family: Courier New,Courier,monospace">-webkit-transform</span> CSS property.</p>
<pre class="prettyprint">
/* main.js */
var lastAngle = 0, /* Last measurement */
&nbsp;&nbsp;&nbsp;&nbsp;rotation = 0; /* Compass rotation */

function onDeviceOrientation(eventData) 
{
&nbsp;&nbsp;&nbsp;var angle = eventData.alpha,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;deltaAngle,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text = &#39;&#39;;

&nbsp;&nbsp;&nbsp;/* Check whether the angle has changed since the last measurement */
&nbsp;&nbsp;&nbsp;if (isNaN(eventData.alpha) ||
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eventData.alpha === lastAngle) 
&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;
&nbsp;&nbsp;&nbsp;}

&nbsp;&nbsp;&nbsp;/* Find direction from a given angle */
&nbsp;&nbsp;&nbsp;if (angle &lt; 68 || angle &gt; 292) 
&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text = &#39;NORTH&#39;;
&nbsp;&nbsp;&nbsp;} 
&nbsp;&nbsp;&nbsp;else if (angle &gt; 112 &amp;&amp; angle &lt; 248) 
&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text = &#39;SOUTH&#39;;
&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;if (angle &gt; 22 &amp;&amp; angle &lt; 158) 
&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text += &#39;EAST&#39;;
&nbsp;&nbsp;&nbsp;} 
&nbsp;&nbsp;&nbsp;else if (angle &gt; 202 &amp;&amp; angle &lt; 338) 
&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text += &#39;WEST&#39;;
&nbsp;&nbsp;&nbsp;}

&nbsp;&nbsp;&nbsp;/* Calculate the rotation of the compass */
&nbsp;&nbsp;&nbsp;deltaAngle = lastAngle - angle;
&nbsp;&nbsp;&nbsp;if (deltaAngle &gt; 180) 
&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rotation -= 360 - deltaAngle;
&nbsp;&nbsp;&nbsp;} 
&nbsp;&nbsp;&nbsp;else if (deltaAngle &lt; -180) 
&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rotation += 360 + deltaAngle;
&nbsp;&nbsp;&nbsp;} 
&nbsp;&nbsp;&nbsp;else 
&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rotation += deltaAngle;
&nbsp;&nbsp;&nbsp;}

&nbsp;&nbsp;&nbsp;/* Save the current value */
&nbsp;&nbsp;&nbsp;lastAngle = angle;

&nbsp;&nbsp;&nbsp;/* Update the direction and angle labels */
&nbsp;&nbsp;&nbsp;directionEl.innerHTML = text;
&nbsp;&nbsp;&nbsp;angleEl.innerHTML =
&nbsp;&nbsp;&nbsp;Math.round(angle) + &#39;&deg;&#39;;
&nbsp;&nbsp;&nbsp;/* Rotate the compass image */
&nbsp;&nbsp;&nbsp;rotationEl.style[&#39;-webkit-transform&#39;] = &#39;rotate(&#39; + rotation + &#39;deg)&#39;;
}
</pre>

  
  
<script type="text/javascript" src="../scripts/jquery.zclip.min.js"></script>
<script type="text/javascript" src="../scripts/showhide.js"></script>
</div></div></div>

<a class="top sms" href="#"><img src="../images/btn_top.gif" alt="Go to top" /></a>

<div id="footer">
<p class="footer">Except as noted, this content - excluding the Code Examples - is licensed under <a href="http://creativecommons.org/licenses/by/3.0/legalcode" target="_blank">Creative Commons Attribution 3.0</a> and all of the Code Examples contained herein are licensed under <a href="https://www.tizen.org/bsd-3-clause-license" target="_blank">BSD-3-Clause</a>.<br/>For details, see the <a href="https://www.tizen.org/content-license" target="_blank">Content License</a>.</p>
</div>

<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-25976949-1']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>

</body>
</html>