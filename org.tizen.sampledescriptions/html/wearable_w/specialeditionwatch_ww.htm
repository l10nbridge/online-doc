<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=9" />
	<link rel="stylesheet" type="text/css" href="../css/styles.css" />
	<link rel="stylesheet" type="text/css" href="../css/snippet.css" />
	<script type="text/javascript" src="../scripts/snippet.js"></script>
	<script type="text/javascript" src="../scripts/jquery.util.js" charset="utf-8"></script>
	<script type="text/javascript" src="../scripts/common.js" charset="utf-8"></script>
	<script type="text/javascript" src="../scripts/core.js" charset="utf-8"></script>
	<script type="text/javascript" src="../scripts/search.js" charset="utf-8"></script>

	<title>Special Edition Watchface Overview</title>
</head>

<body onload="prettyPrint()" style="overflow: auto;">

<div id="toc-navigation">
	<div id="profile">
		<p><img alt="Wearable Web" src="../images/wearable_s_w.png"/></p>
	</div>

	<div id="toc_border"><div id="toc">
		<p class="toc-title">Related Info</p>
		<ul class="toc">
           <li><a href="../../../org.tizen.guides/html/web/tizen/system/time_w.htm">Time Guide</a></li>
           <li><a href="../../../org.tizen.web.apireference/html/device_api/wearable/tizen/time.html">Time API</a></li>
		</ul>
	</div></div>
</div>

<div id="container"><div id="contents"><div class="content">
  <h1>Special Edition Watch Overview</h1>
 <p>The Special Edition Watch sample application demonstrating how to implement Tizen official Special Edition Watchface app with full functionality using the Tizen Time API.</p>
 <p>For information on creating the sample application project in the IDE, see <a href="../cover_page.htm#create">Creating Web Sample Applications</a>.</p>
 <p>The following figure illustrates the main screen of the Special Edition Watch.</p>
 <p class="figure">Figure: Special Edition Watchface screen</p>
 <p align="center">
     <img alt="SpecialEdition Watch screen" src="../images/specialedition_ww1.png" />
 </p>
 <p>The watchface opens with the main screen that shows current time and date.</p>
 <p>Moreover, the watchface application shows the current status of moon phase.</p>

 <h2>Source Files</h2>
 <p>You can create and view the sample application project including the source files in the IDE.</p>
 <table border="1">
 <tbody>
 <tr>
 <th>File name</th>
 <th>Description</th>
 </tr>
 <tr>
 <td><span style="font-family: Courier New,Courier,monospace">config.xml</span></td>
 <td>This file contains the application information for the platform to install and launch the application, including the view mode and the icon to be used in the device menu.</td>
 </tr>
 <tr>
 <td><span style="font-family: Courier New,Courier,monospace">css/style.css</span></td>
 <td>This file contains the CSS styling for the application UI.</td>
 </tr>
 <tr>
 <td><span style="font-family: Courier New,Courier,monospace">index.html</span></td>
 <td>This is a starting file from which the application starts loading. It contains the layout of the application screens.</td>
 </tr>
 <tr>
 <td><span style="font-family: Courier New,Courier,monospace">js/app.js</span></td>
 <td>This file starts the application.</td>
 </tr>
 <tr>
 <td><span style="font-family: Courier New,Courier,monospace">js/moonphase.js</span></td>
 <td>This file calculate the angle that is used to rotate moon image.</td>
 </tr>
 </tbody>
 </table>

 <h2>Implementation</h2>

 <h3>Defining the Application Layout</h3>

<p>The application has only one screen, whose content is defined in the index.html file:</p>

<ul>
 <li>
 <p>There are 4 sections (date number, hand, calendar and moon phase) .</p>
 <pre class="prettyprint">
&lt;!-- body section --&gt;
&lt;div id=&quot;body-bg&quot;&gt;
    &lt;!-- date number section --&gt;
    &lt;div id=&quot;body-date-num&quot;&gt;
        &lt;div id=&quot;date-num-string&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;

    &lt;!-- hand section --&gt;
    &lt;div id=&quot;body-sec-hand&quot; class=&quot;sec-hand&quot;&gt;&lt;/div&gt;
    &lt;div id=&quot;body-sec-hand-shadow&quot; class=&quot;sec-hand&quot;&gt;&lt;/div&gt;
    &lt;div id=&quot;body-min-hand&quot; class=&quot;min-hand&quot;&gt;&lt;/div&gt;
    &lt;div id=&quot;body-min-hand-shadow&quot; class=&quot;min-hand&quot;&gt;&lt;/div&gt;
    &lt;div id=&quot;body-hr-hand&quot; class=&quot;hr-hand&quot;&gt;&lt;/div&gt;
    &lt;div id=&quot;body-hr-hand-shadow&quot; class=&quot;hr-hand&quot;&gt;&lt;/div&gt;

    &lt;!-- calendar section --&gt;
    &lt;div id=&quot;body-calendar-unit&quot;&gt;&lt;/div&gt;
    &lt;div id=&quot;body-calendar-stroke&quot;&gt;&lt;/div&gt;
    &lt;div id=&quot;body-calendar-hand&quot; class=&quot;calendar-hand&quot;&gt;&lt;/div&gt;
    &lt;div id=&quot;body-calendar-hand_shadow&quot; class=&quot;calendar-hand&quot;&gt;&lt;/div&gt;

    &lt;!-- moon phase section --&gt;
    &lt;div id=&quot;body-moonphase&quot;&gt;
        &lt;div id=&quot;moonphase-cover&quot;&gt;&lt;/div&gt;
        &lt;div id=&quot;moonphase-moon&quot;&gt;&lt;/div&gt;
        &lt;div id=&quot;moonphase-nightsky&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;</pre>
 </li>
</ul>

 <h3>Displaying Moon Phase Images on the Screen</h3>

<p>This application uses 3 images for moon phase function.</p>

<p class="figure">Figure: 3 Images for Moonphase function</p>
<p align="center">
     <img alt="SpecialEdition screen" src="../images/specialedition_moonphase1.png" />
     <img alt="SpecialEdition screen" src="../images/specialedition_moonphase3.png" />
     <img alt="SpecialEdition screen" src="../images/specialedition_moonphase2.png" />

</p>

<ul>
 <li>
 <p>Put the first image on the lowest layer and the third image at the top. The second image is put in between the first and the third images.</p>
 <p>Only the second image rotates at the calculated angle for moon phase function.</p>
 <p>Use the 'z-index' attribute to put the three images on top of each other.</p>
 <p>The element with a higher value of the 'z-index' are put on top of those with lower 'z-index' values.</p>

 <pre class="prettyprint">
/* style/style.css */

#moonphase-nightsky {
    position: absolute;
    width: 100%;
    height: 100%;
    z-index: 1;
    background-image: url('../image/premium_02_calendar_moonphase_nightsky_01.png');
}

#moonphase-moon {
    position: absolute;
    width: 100%;
    height: 100%;
    z-index: 2;
    background-image: url('../image/premium_02_calendar_moonphase_moon.png');
}

#moonphase-cover {
    position: absolute;
    width: 100%;
    height: 100%;
    z-index: 3;
    background-image: url('../image/premium_02_calendar_moonphase_cover_01.png');
}
</pre>
 </li>
</ul>

<h3>Calculating Rotating Angle for Moon Phase Function</h3>

<p>In this application, 'New Moon' is defined as the standard point to calculate rotating angle.</p>

<ul>
 <li>
 <p>The rotating angle for 'New Moon' in the images is 60 degrees.</p>
 <pre class="prettyprint">
/* js/app.js */

    var NEW_MOON_ANGLE = 60;</pre>
 </li>

 <p class="figure">Figure: Moon phase at 'New Moon' angle (regardless of the current date)</p>
 <p align="center">
     <img alt="SpecialEdition screen" src="../images/specialedition_moonphase4.png" />
 </p>
 <li>
 <p>Using current date, find the current time stamp in the moon phase calendar and calculate the angle to rotate.</p>
 <p>Finally, add the angle and the standard point angle for 'New Moon'.</p>
 <p>Then, the final rotating angle is calculated by adding <span style="font-family: Courier New,Courier,monospace">NEW_MOON_ANGLE</span>(60 degrees) and the angle for the current moon phase status.</p>
 <pre class="prettyprint">
/* js/app.js */

    // parameter of moonphase.inputDate() is date information,
    // then it returns rotate angle based on new moon.
    rotateAngle = moonphase.inputDate(dateInformation);
    rotateElement(NEW_MOON_ANGLE + rotateAngle, "moonphase-moon");</pre>
 </li>
</ul>

<p>Moreover, this application uses the time stamp of the moon phase calendar to calculate the rotating angle.</p>
<ul>
 <li>
 <p>First, add the time stamp data of moon phase calendar to an array.</p>
 <p>In this sample, it adds time stamp data for only 5 years. (2016~2020)</p>
 <p>For example, it can check the 2016 data array set as below.</p>
 <pre class="prettyprint">
/* js/moonphase.js */

    MOON_PHASE_DATA = [
        // 2016 data set.
        // first phase stamp is "Last Quarter".
        [
            "0102","0110","0116","0124",
            "0201","0208","0215","0222",
            "0301","0309","0315","0323","0331",
            "0407","0414","0422","0430",
            "0506","0513","0521","0529",
            "0605","0612","0620","0627",
            "0704","0712","0719","0726",
            "0802","0810","0818","0825",
            "0901","0909","0916","0923",
            "1001","1009","1016","1022","1030",
            "1107","1114","1121","1129",
            "1207","1214","1221","1229"
        ],</pre>
 </li>
 <li>
 <p>For each year, set first stamp to array.</p>
 <p>For example, the first time stamp of 2016 is "Last Quarter".</p>
 <pre class="prettyprint">
/* js/moonphase.js */

    /**
     * For each year, set first stamp. (2016 ~ 2020)
     * 0 : New Moon
     * 1 : First Quarter
     * 2 : Full Moon
     * 3 : Last Quarter
     * @type {number[]}
     */
    MOON_PHASE_FIRST_ANGLE = [
        3, 1, 2, 0, 1
    ],</pre>
 </li>

 <li>
 <p>Second, find the current time stamp from <span style="font-family: Courier New,Courier,monospace">MOON_PHASE_DATA</span> array using input date information.</p>
 <p>Then, set curent time stamp and next one in the <span style="font-family: Courier New,Courier,monospace">setCurrentStamp()</span> function.</p>
 </li>
 <li>
 <p>For example, suppose current date is "2016-04-21".</p>
 <p>First, find where the current time stamp exits in the <span style="font-family: Courier New,Courier,monospace">MOON_PHASE_DATA</span> array.</p>
 <p>Then, the start stamp is "0414" and the last stamp is "0422" in that array.</p>
 <p>In this example(2016-04-21), the start stamp is "First Quater" and the last stamp is "Full Moon".</p>
 <p>In other words, current moon phase is in the waxing status from the first quater to full moon.</p>
 <pre class="prettyprint">
/* js/moonphase.js */
    function setCurrentStamp() {
        var i;

        startStamp = lastStamp = &quot;NULL&quot;;

        // find stamp using current date.
        for( i=0; i&lt;MOON_PHASE_DATA[year].length; i++ ) {

            // If stamp date equal to current date, set current stamp to that stamp.
            if(MOON_PHASE_DATA[year][i] === fullDate ) {
                startStamp = lastStamp = MOON_PHASE_DATA[year][i];
                currentStampNumber = (MOON_PHASE_FIRST_ANGLE[year] + i) % 4;
                break;
            }

            // If that's not it, find the median stamp.
            else if(MOON_PHASE_DATA[year][i] &gt; fullDate) {

                // [year][i-1] ~ [year][i]
                startStamp = MOON_PHASE_DATA[year][i-1];
                lastStamp = MOON_PHASE_DATA[year][i];

                // If today is smaller than the first stamp,
                // set startStamp is the last stamp of last year.
                if(i === 0) {
                    startStamp = MOON_PHASE_DATA[year-1][MOON_PHASE_DATA[year-1].length - 1];
                    lastStamp = MOON_PHASE_DATA[year][i];
                }

                currentStampNumber = (MOON_PHASE_FIRST_ANGLE[year] + i + 3) % 4;
                break;
            }
        }

        // There is no stamp in current year, set the first stamp of next year.
        if(startStamp === &quot;NULL&quot; &amp;&amp; lastStamp === &quot;NULL&quot;)
        {
            startStamp = MOON_PHASE_DATA[year][MOON_PHASE_DATA[year].length - 1];
            lastStamp = MOON_PHASE_DATA[year+1][0];
            currentStampNumber = (MOON_PHASE_FIRST_ANGLE[year] + i + 3) % 4;
        }
    }</pre>
 </li>

 <li>
 <p>Now, in order to determine how much it is left for it to become a full moon, the total days in between the start stamp and the last stamp as well as the passing days are calculated in the
    <span style="font-family: Courier New,Courier,monospace">CalcAngle()</span> function.</p>
 <p>The <span style="font-family: Courier New,Courier,monospace">denomiStamp</span> is 9("4022"-"4014") as total days in between start stamp & last stamp.</p>
 <p>The <span style="font-family: Courier New,Courier,monospace">numerStamp</span> is 8("0421"-"0414") as passing days from start stamp to current date.</p>
 </li>
 <li>

 <p>Using these values, the angle for rotating the second image is calculated.</p>
 <p><span style="font-family: Courier New,Courier,monospace">angle</span> = (8/9)*45 + 45 * 1(First Quater)</p>
 <pre class="prettyprint">
/* js/moonphase.js */

    function calcAngle() {
        var denomiStamp = lastStamp - startStamp + 1,
            numerStamp = fullDate - startStamp + 1,
            startSubMonth = parseInt(startStamp.substring(0, 2), 10),
            startSubDay = parseInt(startStamp.substring(2, 4), 10),
            lastSubDay = parseInt(lastStamp.substring(2, 4), 10),
            todaySubDay = parseInt(fullDate.substring(2, 4), 10),
            startYearMonthDay;

        // If current year is leap year.
        if( isLeapYear(year) ) {
            startYearMonthDay = LEAP_YEAR_DAY[startSubMonth-1];
        }
        else {
            startYearMonthDay = YEAR_DAY[startSubMonth-1];
        }

        if(denomiStamp > MINIMUM_DAY_DIFFERENCE || denomiStamp < 0) {
            denomiStamp =  (startYearMonthDay - startSubDay) + 1 + lastSubDay;
        }

        if(numerStamp > MINIMUM_DAY_DIFFERENCE || numerStamp < 0) {
            numerStamp = (startYearMonthDay - startSubDay) + 1 + todaySubDay;
        }

        if(startStamp === lastStamp) {
            angle = 45 * currentStampNumber;
        }
        else {
            angle = (numerStamp / denomiStamp * 45) + 45 * currentStampNumber;
        }
    }</pre>
 </li>
 <p class="figure">Figure: Moon Phase of the Example(2016-04-21)</p>
 <p align="center">
     <img alt="SpecialEdition screen" src="../images/specialedition_moonphase5.png" />
 </p>
</ul>

<script type="text/javascript" src="../scripts/jquery.zclip.min.js"></script>
<script type="text/javascript" src="../scripts/showhide.js"></script>
</div></div></div>

<a class="top sms" href="#"><img src="../images/btn_top.gif" alt="Go to top" /></a>

<div id="footer">
<p class="footer">Except as noted, this content - excluding the Code Examples - is licensed under <a href="http://creativecommons.org/licenses/by/3.0/legalcode" target="_blank">Creative Commons Attribution 3.0</a> and all of the Code Examples contained herein are licensed under <a href="https://www.tizen.org/bsd-3-clause-license" target="_blank">BSD-3-Clause</a>.<br/>For details, see the <a href="https://www.tizen.org/content-license" target="_blank">Content License</a>.</p>
</div>

<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-25976949-1']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>

</body>
</html>
