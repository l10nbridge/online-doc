<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=9" />
	<link rel="stylesheet" type="text/css" href="../css/styles.css" />
	<link rel="stylesheet" type="text/css" href="../css/snippet.css" />
	<script type="text/javascript" src="../scripts/snippet.js"></script>	
	<script type="text/javascript" src="../scripts/jquery.util.js" charset="utf-8"></script>
	<script type="text/javascript" src="../scripts/common.js" charset="utf-8"></script>
	<script type="text/javascript" src="../scripts/core.js" charset="utf-8"></script>
	<script type="text/javascript" src="../scripts/search.js" charset="utf-8"></script>
	<title>Application Control Sample Overview</title>
</head>

<body class="no-toc" onload="prettyPrint()" style="overflow: auto;">

<div id="toc-navigation">
</div>	

<div id="container"><div id="contents"><div class="content">
	<div id="profile">
		<p><img alt="Mobile native" src="../images/mn_icon.png"/></p>
	</div>
  <h1>Application Control Sample Overview</h1>
<p>The Application Control sample application uses the App Control API to search for applications supporting specific operations. The following operations have been selected in this application:</p>
<ul>
	<li><span style="font-family: Courier New,Courier,monospace">APP_CONTROL_OPERATION_VIEW</span>: enables data display</li>
	<li><span style="font-family: Courier New,Courier,monospace">APP_CONTROL_OPERATION_PICK</span>: picks an item from the data</li>
	<li><span style="font-family: Courier New,Courier,monospace">APP_CONTROL_OPERATION_COMPOSE</span>: composes (for example a message)</li>
</ul>
<p>The figure below illustrates the application view.</p>
	<p class="figure">Figure: Application control view</p>
	<p align="center"><img alt="Application control view" src="../images/application_control_0.png" />
</p>

<p>In the main window the application launch panel enables the user to choose one of the available operations, and search, run, and stop found applications. The message composing area enables the user to compose a message, set the destination address, and send it using the default email application.</p>

<h2>Prerequisites</h2>
<p>To ensure proper application execution, the following privileges must be set:</p>
 <ul>
  <li><span style="font-family: Courier New,Courier,monospace">http://tizen.org/privilege/appmanager.kill.bgapp</span></li>
  <li><span style="font-family: Courier New,Courier,monospace">http://tizen.org/privilege/appmanager.launch</span></li>
  <li><span style="font-family: Courier New,Courier,monospace">http://tizen.org/privilege/email</span></li>
  <li><span style="font-family: Courier New,Courier,monospace">http://tizen.org/privilege/datasharing</span></li>
 </ul>

<h2>Implementation</h2>
<h3>Application Launch Panel</h3>

<p>The <span style="font-family: Courier New,Courier,monospace">controller_search_app()</span> function is invoked on a search button click event.</p>

<pre class="prettyprint">
void controller_search_app(int selected_operation_id)
{
&nbsp;&nbsp;&nbsp;app_control_h app_control = NULL;

&nbsp;&nbsp;&nbsp;model_free_app_control_selection();

&nbsp;&nbsp;&nbsp;const char *operation = model_get_operation_name(selected_operation_id);
&nbsp;&nbsp;&nbsp;if (!operation)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;

&nbsp;&nbsp;&nbsp;int ret = app_control_create(&amp;app_control);
&nbsp;&nbsp;&nbsp;// Error handling

&nbsp;&nbsp;&nbsp;ret = app_control_set_operation(app_control, operation);
&nbsp;&nbsp;&nbsp;// Error handling

&nbsp;&nbsp;&nbsp;ret = app_control_foreach_app_matched(app_control, app_control_application_matched_cb, NULL);
&nbsp;&nbsp;&nbsp;// Error handling

&nbsp;&nbsp;&nbsp;app_control_destroy(app_control);
}
</pre>

<p>After the call to the <span style="font-family: Courier New,Courier,monospace">app_control_foreach_app_matched()</span> function, the <span style="font-family: Courier New,Courier,monospace">app_control_application_matched_cb()</span> function is called for each installed application that meets the criteria specified by the operation type. On each call to this function, one radio button is added to the popup window.</p>
<pre class="prettyprint">
static bool app_control_application_matched_cb(app_control_h app_control, const char *appid, void *user_data)
{
&nbsp;&nbsp;&nbsp;bool new_radio_group = false;

&nbsp;&nbsp;&nbsp;if (!view_is_shown_popup_window()) 
&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new_radio_group = true;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Error handling
&nbsp;&nbsp;&nbsp;}

&nbsp;&nbsp;&nbsp;if (view_add_popup_window_radio_button(appid, new_radio_group))
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;model_add_application_id(appid);

&nbsp;&nbsp;&nbsp;view_disable_button(controller_data.viewdata, BUTTON_EXECUTE, EINA_FALSE);

&nbsp;&nbsp;&nbsp;return true;
}
</pre>

<p>Once the user has chosen an application from the popup window, the <strong>Execute</strong> button becomes available. The following code is invoked upon the click event.</p>
<p>The following code launches the selected application using <span style="font-family: Courier New,Courier,monospace">app_control_send_launch_request()</span> API function. Note that it also sets some additional operation data using the <span style="font-family: Courier New,Courier,monospace">app_control_add_extra_data()</span> function. This way, if the application supports these data keys, its behaviour is altered. For instance, the email application is started in the message creation mode. All the necessary message fields are filled with the defined extra data and the message is ready to be sent.</p>
<pre class="prettyprint">
void controller_execute(void)
{
&nbsp;&nbsp;&nbsp;// Declare the variables

&nbsp;&nbsp;&nbsp;if (!model_get_app_control_selection(&amp;operation, &amp;appid)) 
&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Error handling
&nbsp;&nbsp;&nbsp;}

&nbsp;&nbsp;&nbsp;int ret = app_control_set_operation(controller_data.launch_app_control, operation);
&nbsp;&nbsp;&nbsp;// Error handling

&nbsp;&nbsp;&nbsp;ret = app_control_set_app_id(controller_data.launch_app_control, appid);
&nbsp;&nbsp;&nbsp;// Error handling

&nbsp;&nbsp;&nbsp;ret = app_control_add_extra_data(controller_data.launch_app_control, APP_CONTROL_DATA_TO, COMPOSE_OP_RECIPIENT);
&nbsp;&nbsp;&nbsp;if (ret == APP_CONTROL_ERROR_NONE)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret = app_control_add_extra_data(controller_data.launch_app_control, APP_CONTROL_DATA_CC, COMPOSE_OP_RECIPIENT_CC);
&nbsp;&nbsp;&nbsp;if (ret == APP_CONTROL_ERROR_NONE)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret = app_control_add_extra_data(controller_data.launch_app_control, APP_CONTROL_DATA_BCC, COMPOSE_OP_RECIPIENT_BCC);
&nbsp;&nbsp;&nbsp;if (ret == APP_CONTROL_ERROR_NONE)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret = app_control_add_extra_data(controller_data.launch_app_control, APP_CONTROL_DATA_SUBJECT, COMPOSE_OP_SUBJECT);
&nbsp;&nbsp;&nbsp;if (ret == APP_CONTROL_ERROR_NONE)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret = app_control_add_extra_data(controller_data.launch_app_control, APP_CONTROL_DATA_TEXT, COMPOSE_OP_MESSAGE);

&nbsp;&nbsp;&nbsp;// Error handling

&nbsp;&nbsp;&nbsp;ret = app_control_send_launch_request(controller_data.launch_app_control, __app_control_launch_reply_cb, NULL);
&nbsp;&nbsp;&nbsp;// Error handling

&nbsp;&nbsp;&nbsp;view_disable_button(controller_data.viewdata, BUTTON_KILL, EINA_FALSE);
}
</pre>


<h3>Message Composing Area</h3>

<p>This sample application also gives the user the possibility to compose a message and launch the default email application for the message to be sent. When <strong>Send message</strong> button is clicked, the following code is executed:</p>

<pre class="prettyprint">
void controller_send_message(const char *email_address, const char *email_body)
{
&nbsp;&nbsp;&nbsp;app_control_h app_control = NULL;

&nbsp;&nbsp;&nbsp;int ret = app_control_create(&amp;app_control);
&nbsp;&nbsp;&nbsp;// Error handling

&nbsp;&nbsp;&nbsp;ret = app_control_set_launch_mode(app_control, APP_CONTROL_LAUNCH_MODE_GROUP);
&nbsp;&nbsp;&nbsp;// Error handling

&nbsp;&nbsp;&nbsp;ret = app_control_set_operation(app_control, APP_CONTROL_OPERATION_COMPOSE);
&nbsp;&nbsp;&nbsp;// Error handling

&nbsp;&nbsp;&nbsp;ret = app_control_set_app_id(app_control, EMAIL_APP_ID);
&nbsp;&nbsp;&nbsp;// Error handling

&nbsp;&nbsp;&nbsp;ret = app_control_add_extra_data(app_control, APP_CONTROL_DATA_TO, email_address);
&nbsp;&nbsp;&nbsp;// Error handling

&nbsp;&nbsp;&nbsp;ret = app_control_add_extra_data(app_control, APP_CONTROL_DATA_SUBJECT, EMAIL_DEFAULT_MESSAGE_SUBJECT);
&nbsp;&nbsp;&nbsp;// Error handling

&nbsp;&nbsp;&nbsp;ret = app_control_add_extra_data(app_control, APP_CONTROL_DATA_TEXT, email_body);
&nbsp;&nbsp;&nbsp;// Error handling

&nbsp;&nbsp;&nbsp;ret = app_control_send_launch_request(app_control, __app_control_launch_reply_cb, NULL);
&nbsp;&nbsp;&nbsp;// Error handling

&nbsp;&nbsp;&nbsp;app_control_destroy(app_control);
}
</pre>
  
  
<script type="text/javascript" src="../scripts/jquery.zclip.min.js"></script>
<script type="text/javascript" src="../scripts/showhide.js"></script>
</div></div></div>

<a class="top sms" href="#"><img src="../images/btn_top.gif" alt="Go to top" /></a>

<div id="footer">
<p class="footer">Except as noted, this content - excluding the Code Examples - is licensed under <a href="http://creativecommons.org/licenses/by/3.0/legalcode" target="_blank">Creative Commons Attribution 3.0</a> and all of the Code Examples contained herein are licensed under <a href="https://www.tizen.org/bsd-3-clause-license" target="_blank">BSD-3-Clause</a>.<br/>For details, see the <a href="https://www.tizen.org/content-license" target="_blank">Content License</a>.</p>
</div>

<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-25976949-1']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>

</body>
</html>