<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=9" />
	<link rel="stylesheet" type="text/css" href="../css/styles.css" />
	<link rel="stylesheet" type="text/css" href="../css/snippet.css" />
	<script type="text/javascript" src="../scripts/snippet.js"></script>
	<script type="text/javascript" src="../scripts/jquery.util.js" charset="utf-8"></script>
	<script type="text/javascript" src="../scripts/common.js" charset="utf-8"></script>
	<script type="text/javascript" src="../scripts/core.js" charset="utf-8"></script>
	<script type="text/javascript" src="../scripts/search.js" charset="utf-8"></script>

	<title>Sync Adapter Service App Sample Overview</title>
</head>

<body class="no-toc" onload="prettyPrint()" style="overflow: auto;">

<div id="toc-navigation">
</div>

<div id="container"><div id="contents"><div class="content">
<div id="profile">
		<p><img alt="Mobile native" src="../images/mobile_s_n.png"/></p>
</div>

<h1>Sync Adapter Service App Sample Overview</h1>
<p>The Sync Adapter Service App sample application demonstrates how you can create an application that acts as a sync adapter to the <a href="./syncadapterapp_sd_mn.htm">Sync Adapter App</a> UI application. The service application handles all sync requests from the UI application. The Sync Adapter Service App sample demonstrates how the sync callbacks are implemented to handle sync requests.</p>

<h2>Prerequisites</h2>
<ul>
<li>Sync Adapter Service App&#39;s app ID must be <span style="font-family: Courier New,Courier,monospace">org.tizen.syncadapterapp.service</span>, because the Sync Adapter App uses this ID as a fixed value when it communicates with the Sync Adapter Service App. Otherwise, the application control communication does not operate properly.
<p>In addition, the Sync Adapter Service App package name must be <span style="font-family: Courier New,Courier,monospace">org.tizen.syncadapterapp</span> (same as the Sync Adapter App).</p></li>
<li>The Sync Adapter App and Sync Adapter Service App packages must be coupled during the build process. To couple the packages:
<ol><li>On the Tizen IDE, right-click the Sync Adapter App project and select <strong>Properties</strong>.</li>
<li>Select <strong>Project References</strong> and find <strong>Sync Adapter Service App</strong>.</li>
<li>Select the <strong>Sync Adapter Service App</strong> check box and click <strong>OK</strong>.</li></ol>
<p>In the <strong>Project Explorer</strong> view, a <strong>with the Sync Adapter App</strong> message appears next to the Sync Adapter Service App project name showing that you have coupled it successfully.</p></li>
<li>
<p>To ensure proper application execution, the following privileges must be set:</p>
<ul>
	<li><span style="font-family: Courier New,Courier,monospace">http://tizen.org/privilege/account.read</span></li>
	<li><span style="font-family: Courier New,Courier,monospace">http://tizen.org/privilege/account.write</span></li>
	<li><span style="font-family: Courier New,Courier,monospace">http://tizen.org/privilege/appmanager.launch</span></li>
	<li><span style="font-family: Courier New,Courier,monospace">http://tizen.org/privilege/content.write</span></li>
	<li><span style="font-family: Courier New,Courier,monospace">http://tizen.org/privilege/packagemanager.info</span></li>
</ul>
</li>
</ul>


<h2>Implementation</h2>

<h3>Application Initialization</h3>

<p>Register the service application as a sync adapter by passing the sync callbacks to the <span style="font-family: Courier New,Courier,monospace">sync_adapter_set_callbacks()</span> function:</p>
<pre class="prettyprint">
bool 
service_app_create(void *data)
{
&nbsp;&nbsp;&nbsp;dlog_print(DLOG_INFO, LOG_TAG, &quot;service_app_create called&quot;);

&nbsp;&nbsp;&nbsp;sync_adapter_set_callbacks(handleStartSync, handleStopSync);

&nbsp;&nbsp;&nbsp;return true;
}
</pre>


<h3>Sync Start</h3>

<p>Whenever the sync manager schedules a sync job for the Sync Adapter App UI application, the following callback is triggered to perform a sync job. The Sync Adapter Service App communicates the information to the Sync Adapter App UI application using an application control.</p>
<pre class="prettyprint">
static bool 
handleStartSync(account_h account, const char *sync_job_name, const char *sync_capability, bundle *sync_job_user_data)
{
&nbsp;&nbsp;&nbsp;dlog_print(DLOG_INFO, LOG_TAG, &quot;HandleStartSync called in service app&quot;);

&nbsp;&nbsp;&nbsp;bool is_data_change = sync_capability ? true : false;

&nbsp;&nbsp;&nbsp;if (sync_job_name)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dlog_print(DLOG_INFO, LOG_TAG, &quot;Sync Job Name [%s]&quot;, sync_job_name);
&nbsp;&nbsp;&nbsp;else
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dlog_print(DLOG_INFO, LOG_TAG, &quot;Data Change Sync Job Capability [%s]&quot;, sync_capability);

&nbsp;&nbsp;&nbsp;if (account)
&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int id;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;account_get_account_id(account, &amp;id);

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dlog_print(DLOG_INFO, LOG_TAG, &quot;account [%d]&quot;, id);
&nbsp;&nbsp;&nbsp;} 
&nbsp;&nbsp;&nbsp;else
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dlog_print(DLOG_INFO, LOG_TAG, &quot;accountless case&quot;);

&nbsp;&nbsp;&nbsp;app_control_h app_control;
&nbsp;&nbsp;&nbsp;int ret = app_control_create(&amp;app_control);
&nbsp;&nbsp;&nbsp;ret = app_control_set_app_id(app_control, SYNC_ADAPTER_APP_ID);
&nbsp;&nbsp;&nbsp;if (ret == APP_CONTROL_ERROR_NONE)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dlog_print(DLOG_INFO, LOG_TAG, &quot;Launching sync UI app successfully [%s]&quot;, SYNC_ADAPTER_APP_ID);
&nbsp;&nbsp;&nbsp;else
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dlog_print(DLOG_INFO, LOG_TAG, &quot;Launching sync UI app failed [%s]&quot;, get_error_message(ret));

&nbsp;&nbsp;&nbsp;if (is_data_change) 
&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret = app_control_set_operation(app_control, &quot;http://tizen.org/appcontrol/operation/data_change_sync_complete&quot;);
&nbsp;&nbsp;&nbsp;} 
&nbsp;&nbsp;&nbsp;else 
&nbsp;&nbsp;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bool is_periodic = !strcmp(sync_job_name, &quot;Periodic&quot;) ? true : false;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (is_periodic)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret = app_control_set_operation(app_control, &quot;http://tizen.org/appcontrol/operation/periodic_sync_complete&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret = app_control_set_operation(app_control, &quot;http://tizen.org/appcontrol/operation/on_demand_sync_complete&quot;);
&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;dlog_print(DLOG_INFO, LOG_TAG, &quot;sync operation is completed&quot;);

&nbsp;&nbsp;&nbsp;app_control_send_launch_request(app_control, NULL, NULL);

&nbsp;&nbsp;&nbsp;return true;
}
</pre>



<h3>Sync Stop</h3>

<p>To safely stop and cancel any ongoing sync jobs, use the following callback function:</p>
<pre class="prettyprint">
static void 
handleStopSync(account_h account, const char *capability)
{
&nbsp;&nbsp;&nbsp;dlog_print(DLOG_INFO, LOG_TAG, &quot;HandleStopSync called in service app&quot;);

&nbsp;&nbsp;&nbsp;int id;
&nbsp;&nbsp;&nbsp;account_get_account_id(account, &amp;id);
&nbsp;&nbsp;&nbsp;dlog_print(DLOG_INFO, LOG_TAG, &quot;details %d, %s &quot;, id, capability);
&nbsp;&nbsp;&nbsp;dlog_print(DLOG_INFO, LOG_TAG, &quot;HandleStopSync called in client&quot;);
}
</pre>


<script type="text/javascript" src="../scripts/jquery.zclip.min.js"></script>
<script type="text/javascript" src="../scripts/showhide.js"></script>
</div></div></div>

<a class="top sms" href="#"><img src="../images/btn_top.gif" alt="Go to top" /></a>

<div id="footer">
<p class="footer">Except as noted, this content - excluding the Code Examples - is licensed under <a href="http://creativecommons.org/licenses/by/3.0/legalcode" target="_blank">Creative Commons Attribution 3.0</a> and all of the Code Examples contained herein are licensed under <a href="https://www.tizen.org/bsd-3-clause-license" target="_blank">BSD-3-Clause</a>.<br/>For details, see the <a href="https://www.tizen.org/content-license" target="_blank">Content License</a>.</p>
</div>

<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-25976949-1']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>

</body>
</html>
