<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=9" />
	<link rel="stylesheet" type="text/css" href="../css/styles.css" />
	<link rel="stylesheet" type="text/css" href="../css/snippet.css" />
	<script type="text/javascript" src="../scripts/snippet.js"></script>
	<script type="text/javascript" src="../scripts/jquery.util.js" charset="utf-8"></script>
	<script type="text/javascript" src="../scripts/common.js" charset="utf-8"></script>
	<script type="text/javascript" src="../scripts/core.js" charset="utf-8"></script>
	<script type="text/javascript" src="../scripts/search.js" charset="utf-8"></script>

	<title>Sync Adapter Service App Sample Overview</title>
</head>

<body class="no-toc" onload="prettyPrint()" style="overflow: auto;">

<div id="toc-navigation">
</div>

<div id="container"><div id="contents"><div class="content">
<div id="profile">
		<p><img alt="Mobile native" src="../images/mobile_s_n.png"/></p>
</div>



<h1>Sync Adapter Service Sample Overview</h1>
<p>The Sync Adapter Service App acts as a sync adapter to <a href="./syncadapterapp_sd_mn.htm">Sync Adapter App</a>. The service application handles all sync requests from Sync Adapter App.</p>



<h2>Prerequisites</h2>
<ol>
<li>Sync Adapter Service App's app id must be <strong>"org.tizen.syncadapterapp.service"</strong>. Because <strong>Sync Adapter App</strong> use this ID as fixed value, when the app communicates with Sync Adapter Service App. Also, Sync Adapter Service App's package name must be <strong>"org.tizen.syncadapterapp"</strong> as same with Sync Adapter App's.</li>
<li>To ensure proper application execution, the following privileges must be set:
<ul>
	<li><span style="font-family: Courier New,Courier,monospace">http://tizen.org/privilege/account.read</span></li>
	<li><span style="font-family: Courier New,Courier,monospace">http://tizen.org/privilege/account.write</span></li>
	<li><span style="font-family: Courier New,Courier,monospace">http://tizen.org/privilege/appmanager.launch</span></li>
	<li><span style="font-family: Courier New,Courier,monospace">http://tizen.org/privilege/content.write</span></li>
	<li><span style="font-family: Courier New,Courier,monospace">http://tizen.org/privilege/packagemanager.info</span></li>
</ul>
</li>
<li>Register the service application as a sync adapter by passing the sync callback functions to the following sync adapter API.
<pre class="prettyprint">
bool service_app_create(void *data)
{
	dlog_print(DLOG_INFO, LOG_TAG, "service_app_create called");

	sync_adapter_set_callbacks(handleStartSync, handleStopSync);
	...
	...

	return true;
}</pre>
</li>
</ol>



<h2>Start Sync</h2>
<h3>Handle Start Sync</h3>
<li>Whenever sync manager schedules a sync job for Sync Adapter App, the following callback function will be tirgger to perform the sync job.
The Sync Adapter Service App will communicates to Sync Adapter App by using app control.
<pre class="prettyprint">
static bool handleStartSync(account_h account, const char *sync_job_name, const char *sync_capability, bundle *sync_job_user_data)
{
	dlog_print(DLOG_INFO, LOG_TAG, "HandleStartSync called in service app");

	bool is_data_change = sync_capability ? true : false;

	if (sync_job_name)
		dlog_print(DLOG_INFO, LOG_TAG, "Sync Job Name [%s]", sync_job_name);
	else
		dlog_print(DLOG_INFO, LOG_TAG, "Data Change Sync Job Capability [%s]", sync_capability);

	if (account) {
		int id;
		account_get_account_id(account, &amp;id);
		dlog_print(DLOG_INFO, LOG_TAG, "account [%d] ", id);
	} else
		dlog_print(DLOG_INFO, LOG_TAG, "accountless case");

	app_control_h app_control;
	int ret = app_control_create(&amp;app_control);
	ret = app_control_set_app_id(app_control, SYNC_ADAPTER_APP_ID);
	if (ret == APP_CONTROL_ERROR_NONE)
		dlog_print(DLOG_INFO, LOG_TAG, "Launching sync UI app successfully [%s]", SYNC_ADAPTER_APP_ID);
	else
		dlog_print(DLOG_INFO, LOG_TAG, "Launching sync UI app failed [%s]", get_error_message(ret));

	if (is_data_change) {
		ret = app_control_set_operation(app_control, "http://tizen.org/appcontrol/operation/data_change_sync_complete");
	} else {
		bool is_periodic = !strcmp(sync_job_name, "Periodic") ? true : false;
		if (is_periodic)
			ret = app_control_set_operation(app_control, "http://tizen.org/appcontrol/operation/periodic_sync_complete");
		else
			ret = app_control_set_operation(app_control, "http://tizen.org/appcontrol/operation/on_demand_sync_complete");
	}
	dlog_print(DLOG_INFO, LOG_TAG, "sync operation is completed");

	app_control_send_launch_request(app_control, NULL, NULL);

	return 0;
}</pre>
</li>



<h2>Stop Sync</h2>
<h3>Handle Stop Sync</h3>
<li>This callback function is a notification to inform Sync Adapter Service App to stop and safely cancel ongoing sync job (if any).
<pre class="prettyprint">
static void handleStopSync(account_h account, const char *capability)
{
	dlog_print(DLOG_INFO, LOG_TAG, "HandleStopSync called in service app");

	int id;
	account_get_account_id(account, &amp;id);
	dlog_print(DLOG_INFO, LOG_TAG, "details %d, %s ", id, capability);
	dlog_print(DLOG_INFO, LOG_TAG, "HandleStopSync called in client");
}</pre>
</li>



<script type="text/javascript" src="../scripts/jquery.zclip.min.js"></script>
<script type="text/javascript" src="../scripts/showhide.js"></script>
</div></div></div>

<a class="top sms" href="#"><img src="../images/btn_top.gif" alt="Go to top" /></a>

<div id="footer">
<p class="footer">Except as noted, this content - excluding the Code Examples - is licensed under <a href="http://creativecommons.org/licenses/by/3.0/legalcode" target="_blank">Creative Commons Attribution 3.0</a> and all of the Code Examples contained herein are licensed under <a href="https://www.tizen.org/bsd-3-clause-license" target="_blank">BSD-3-Clause</a>.<br/>For details, see the <a href="https://www.tizen.org/content-license" target="_blank">Content License</a>.</p>
</div>

<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-25976949-1']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>

</body>
</html>
